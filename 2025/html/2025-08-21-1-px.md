# 1px 问题

## 什么是 1px 问题？

1px 问题是指在高分辨率屏幕（如 Retina 屏幕）上，CSS 中设置的 1px 边框在视觉上显示为 2px 或更粗的问题。这个问题直接跟设备像素比（Device Pixel Ratio, DPR）有关。

设备像素比（DPR），指设备的物理像素与 CSS 像素的比例，即 `DPR = 物理像素 / CSS像素`。

- 在普通屏幕中，一个 CSS 像素对应一个物理像素，此时 DPR 为 1。
- 在 Retina 屏幕中，一个 CSS 像素对应四个（2*2）物理像素，此时 DPR 为 2。
- 高分辨率屏幕中，一个 CSS 像素对应九个（3x3）物理像素，此时 DPR 为 3。

对于设置了 1px 的边框，浏览器会将 1px 的 CSS 像素映射到多个物理像素上，在高 DPR 设备上，1px 边框会被放大显示，导致视觉上变粗。

1px 问题不只会出现在设置边框时，只要使用 1px 的地方，就可能产生这个问题。

## 解决方案

### 伪元素 + `transform: scale(0.5)`（推荐）

这种方式的原理是，将元素放大 2 倍，然后通过 `transform` 缩小为原来的 1/2，这样 1px 的边框在视觉上就变成了 `0.5px`。

```css
.box {
  position: relative;
}

.box::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 200%;
  height: 200%;
  border: 1px solid #000;
  transform: scale(1/2);
  transform-origin: 0 0;
}
```

上面的代码在 DPR 为 2 的设备上显示效果如下。

![Transform 边框](/2025/assets/transform-border.png "Transform 边框")

注意，如果要在 DPR 等于 3 的设备上实现 1px 边框，需要将上面代码的 `transform` 属性指定为 `scale(1/3)`。

上面的代码实际上执行了下面的步骤。

1. 首先将伪元素移动到父元素左上角 `(0, 0)` 位置处。
2. `200%` 使伪元素的宽和高分别为父元素的 2 倍，此时，伪元素的宽高变为 `200px`。
3. 设置伪元素的边框为 `1px`，此时 1px 边框是有问题的，1px 覆盖率 2*2 个物理像素。
4. 以伪元素 `(0, 0)` 位置为原点，`transform: scale(0.5)` 将伪元素缩小为原来的 1/2，尺寸和边框宽度被缩小为原来的一半。

### `box-shadow`

这种方式的原理是，利用 `box-shadow` 的 `inset` 属性创建内阴影，通过设置很小的阴影值来模拟细边框。

```css
.box  {
  box-shadow: inset 0 0 0 1px #000;
}
```

上面的代码有六个参数位置，此时，每个位置的含义如下。

```text
box-shadow: [内阴影] [水平偏移] [垂直偏移] [模糊半径] [扩散半径] [颜色]
```

- `inset` 内阴影，表示阴影绘制在元素内部，而非外部。默认绘制在外部。
- 水平偏移，阴影在水平方向的偏移距离，0 表示不偏移，阴影居中。
- 垂直偏移，阴影在垂直方向的偏移距离，0 表示不偏移，阴影居中。
- 模糊半径，阴影的模糊程度，0 表示不模糊，边缘清晰。
- 扩散半径，阴影的扩散范围，决定"边框"的粗细，1px 表示1像素宽的边框。
- 颜色，阴影的颜色。

上面的代码在2倍屏下显示效果如下。

![Box Shadow 边框](/2025/assets/box-shadow-border.png "Box Shadow 边框")

### `border-image`

使用 1px 高的图片作为边框，通过图片的缩放来实现细边框效果。

```css
.box  {
  border: 1px solid transparent;
  border-image: linear-gradient(to bottom, #000 50%, transparent 50%) 1;
}
```

![Border Image 边框](/2025/assets/border-image-border.png "Border Image 边框")

这种方式可以实现渐变边框，但需要额外的图片资源，成本高较高。

### CSS 变量 + 媒体查询

根据设备 DPR 动态设置边框宽度，使用 CSS 变量实现响应式边框。

```css
:root {
  --border-width: 1px;
}

/* 2 倍屏 */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
  :root {
    --border-width: 0.5px;
  }
}

/* 3 倍屏 */
@media (-webkit-min-device-pixel-ratio: 3), (min-resolution: 288dpi) {
  :root {
    --border-width: 0.33px;
  }
}

.box {
  border: var(--border-width) solid #000;
}
```

![CSS 变量边框](/2025/assets/css-var-border.png "CSS 变量边框")

### 伪元素 + 渐变

使用伪元素创建渐变背景，通过渐变实现细边框效果。

```css
.box {
  position: relative;
}

.border-1px::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(to right, #000 0%, #000 50%, transparent 50%, transparent 100%);
  background-size: 100% 1px;
  background-repeat: no-repeat;
  background-position: 0 0;
}
```

![渐变边框](/2025/assets/gradient-border.png "渐变边框")

### viewport meta 标签

通过设置 viewport 的 `initial-scale` 来控制页面缩放，将 DPR 为 2 的设备虚拟为 DPR 为 1。

```html
<meta name="viewport" content="width=device-width, initial-scale=0.5, maximum-scale=0.5, minimum-scale=0.5">
```

这种方式是一种全局解决方案，会影响整个页面的缩放，请谨慎使用。

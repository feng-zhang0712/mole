# 项目信息

## 项目介绍

### 使用的技术

- BEM 命名 + sass

### 项目中的第三方库

- `classnames`
- `prop-types`

## 我的职责/贡献

- 正常的开发工作。
- 负责优化对 webpack 打包的优化。
- 通过 web workers，负责优化了 Reports 模块数据的计算工作，在优化以前，Reports 页面处理大量数据时，偶尔有可感知的卡顿现象，优化后卡顿现象不存在。
- 负责对 Application、Campaign、Creative 等模块的重构和优化（详细分析重构、优化措施），但是由于种种原因，最终没有上线，因为重构完成后不久，项目就被砍了（重构持续了较长时间，一年左右，期间还有其他任务）。

### 项目优化

- 入口优化/首页优化
- 组件结构优化：大组件拆分
- 组件层级优化：useCallback/useMemo + React.memo、useState -> useReducer、useContext、key 优化、debounce/throttle
- 响应式布局/图片
- React.createPortal 封装模态框
- **封装虚拟列表组件**：项目中很多页面用到了列表组件，我对列表组件进行了优化，并封装了虚拟列表 `VirtualList` 组件，优化之后的列表组件，内存占用和用户体验得到提升，即使滚动状态下，列表也没有卡顿效果。

### webpack 打包优化

这部分内容参考 [生产环境优化](/2025/webpack/2027-07-29-optimization-in-production.md)

### 重构

#### 为什么重构项目？

- 新的设计。项目各模块要重新进行 UI 设计。
- 技术债务累积。随着业务快速发展，代码库中积累了很多技术债务。比如，有些组件耦合度太高，经常导致牵一发而动全身的影响，项目变的难以维护；一些工具函数重复实现，代码冗余严重；还有一些历史遗留的代码结构不合理。
- 性能问题。用户和测试组反馈有些页面加载速度变慢，经过性能分析发现存在一些问题，比如，有些数据处理阻塞主线程、不必要的重渲染、内存泄漏等问题。重构后通过代码分割、懒加载、状态管理优化等方式，首屏加载时间减少了30%。
- 可维护性差。原来的代码结构有很多不合理的地方，重构后建立了清晰的组件层次结构，统一了代码规范，现在新功能开发效率提升了40%。
- 技术栈升级。为了跟上技术发展趋势，提升开发体验，我们决定从旧的类组件重构为函数组件 + Hooks。另外，很多框架版本较低，比如 React，当时是 v16+ 版本，优化后，将 React 升级到了当时的最新版 v18+。

#### 实施步骤

重构过程按照从整体到局部的原则进行，遵循渐进式重构的原则，降低重构风险。

1. 首先分析项目架构、性能瓶颈、技术债务等指标。
2. 创建单独的分支 `revamp_v2_application_campaign_creative`，之后的具体工作，基于这个分支创建，每完成一个功能或者模块的重构，提交审核，通过后再执行下一个功能或者模块的重构，目的是为了防止审核时太多重构的内容拥挤在一起，增加审核成本、以及项目出错风险。
3. 并更新 ESLint、Prettier 等插件，做好重构前期准备工作。
4. 对项目结构进行重构，之前项目结构设计不太合理，很多模块堆积在一起。做所以先从这一步开始，是因为不需要改动业务代码，只需改动模块导入路径即可。下面是我重构后的项目结构。

   ```text
   milton/
   ├── src/
   │   ├── core/                    # 核心基础设施
   │   │   ├── app/                # 应用核心（Redux store, 路由等）
   │   │   ├── config/             # 配置管理
   │   │   ├── constants/          # 常量定义
   │   │   ├── hooks/              # 自定义React hooks
   │   │   ├── lib/                # 工具库
   │   │   ├── models/             # 数据模型
   │   │   ├── services/           # API服务层
   │   │   ├── store/              # Redux相关
   │   │   ├── types/              # TypeScript类型定义
   │   │   └── utils/              # 通用工具函数
   │   │
   │   ├── features/               # 按功能域分组
   │   │   ├── campaigns/          # 广告活动相关
   │   │   │   ├── components/     # 功能专用组件
   │   │   │   ├── hooks/          # 功能专用hooks
   │   │   │   ├── services/       # 功能专用服务
   │   │   │   ├── store/          # 功能专用状态管理
   │   │   │   └── views/          # 页面视图
   │   │   ├── creatives/          # 创意相关
   │   │   ├── reports/            # 报表相关
   │   │   ├── accounts/           # 账户管理
   │   │   └── applications/       # 应用管理
   │   │
   │   ├── shared/                 # 共享资源
   │   │   ├── components/         # 通用UI组件
   │   │   │   ├── ui/             # 基础UI组件
   │   │   │   ├── forms/          # 表单组件
   │   │   │   ├── layout/         # 布局组件
   │   │   │   └── feedback/       # 反馈组件
   │   │   ├── hooks/              # 通用hooks
   │   │   ├── utils/              # 通用工具
   │   │   └── styles/             # 全局样式
   │   │
   │   ├── services/               # 服务入口
   │   │   ├── advertiser/         # 广告主服务
   │   │   │   ├── index.js        # 服务入口
   │   │   │   ├── routes.js       # 路由配置
   │   │   │   └── App.js          # 服务根组件
   │   │   └── admin/              # 管理员服务
   │   │       ├── index.js        # 服务入口
   │   │       ├── routes.js       # 路由配置
   │   │       └── App.js          # 服务根组件
   │   │
   │   └── assets/                 # 静态资源
   │       ├── images/
   │       ├── icons/
   │       └── fonts/
   │
   ├── webpack/                     # webpack配置
   ├── scripts/                     # 构建脚本
   ├── tests/                       # 测试文件
   └── docs/                        # 项目文档
   ```

5. 之后重构某个功能模块（`campaign`），将相关的组件、hooks、服务聚合到一起。之所以先重构某个模块，是因为当前模块重构后可以作为其他功能域的模板，并验证新的架构设计是否有效。
6. 之后按相同模式重构 Creatives、Reports、Accounts、Applications，每个功能域保持相同的内部结构。
7. 对共享模块进行重构。
8. 更新测试，确保模块的测试用例完整、达到要求。
9. 删除冗余文件、代码，整理重构文档。

## 参考

- [回答项目难点与亮点](https://juejin.cn/post/7492967922677366819)
